---
# Copyright: (c) 2025, Ansible Project
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

DOCUMENTATION:
  module: website
  short_description: Configures an IIS website
  description:
    - Creates, removes, and configures an IIS website.
  requirements:
    - C(IISAdministration) PowerShell module
  options:
    name:
      description:
        - The name of the website to manage.
      required: true
      type: str
    site_id:
      description:
        - Explicitly set the IIS website numeric ID.
        - Note that this value cannot be changed after the website has been created.
        - The site ID must be available and not used by any other website on the server.
      required: false
      type: str
    state:
      description:
        - State of the website
        - In order to start the website at least one binding should be configured
      type: str
      default: started
      choices: [absent, started, stopped, restarted]
    physical_path:
      description:
        - Specifies the physical folder path on the remote host to use for the website.
        - When create a new website physical_path is required.
        - The specified folder must already exist.
      type: str
    application_pool:
      description:
        - Specifies the application pool in which the website runs.
        - The application pool must already exist - otherwise the website will not start.
      type: str
    bindings:
      description:
        - Specifies the website bindings to add, remove or set.
        - The combination of C(ip:port:hostname) is the binding unique identifier
        - The binding C(ip:port) must be available and not used by any other website on the server.
        - To clear all website bindings, use I(set) with an empty list.
      type: dict
      default: {}
      suboptions:
        add:
          description:
            - Specifies a list of bindings to add to the website.
            - The combination of C(ip:port:hostname) is the binding unique identifier
          type: list
          elements: dict
          suboptions:
            hostname:
              description: The website binding hostname (DNS)
              type: str
            ip:
              description: The website binding listen IP
              type: str
            port:
              description: The website binding listen port
              type: int
            protocol:
              description: The website used protocol (http, https)
              type: str
              default: http
              choices: ["http", "https"]
            require_server_name_indication:
              description:
                - To require Server Name Indication (SNI) for SSL certificates
                - Can be used only if protocol is https
                - When require_server_name_indication is true must specify C(hostname) value
              type: bool
              default: false
            use_centrelized_certificate_store:
              description:
                - To use IIS Centralized Certificate Store (CCS) for SSL certificates
                - Can be used only if protocol is https
                - If Central Certificate Store (CCS) is true C(certificate_hash) and C(certificate_store_name) shouldn't be used.
              type: bool
              default: false
            certificate_hash:
              description:
                - Certificate hash (thumbprint) for the SSL binding. The certificate hash is the unique identifier for the certificate.
                - You can only provide a certificate thumbprint when protocol is set to https
                - When using the Central Certificate Store feature, the certificate is automatically retrieved from the store rather than manually assigned to
                  the binding.
                - C(certificate_hash) and C(certificate_store_name) are required together
              type: str
            certificate_store_name:
              description:
                - Name of the certificate store where the certificate for the binding is located.
                - When using the Central Certificate Store feature, the certificate is automatically retrieved from the store rather than manually assigned to
                - C(certificate_hash) and C(certificate_store_name) are required together
              type: str
        remove:
          description:
            - Specifies a list of bindings to remove from the website.
            - The combination of C(ip:port:hostname) is the binding unique identifier
          type: list
          elements: dict
          suboptions:
            hostname:
              description: The website binding hostname (DNS)
              type: str
            ip:
              description: The website binding listen IP
              type: str
            port:
              description: The website binding listen port
              type: int
        set:
          description:
            - Specifies the exact list of bindings to set to the website.
            - This will remove any existing bindings if not in the specified list.
            - This will add any bindings in the specified list if it does not exist on the website
            - The combination of C(ip:port:hostname) is the binding unique identifier
            - Set to an empty list to clear all the website bindings.
          type: list
          elements: dict
          suboptions:
            hostname:
              description: The website binding hostname (DNS)
              type: str
            ip:
              description: The website binding listen IP
              type: str
            port:
              description: The website binding listen port
              type: int
            protocol:
              description: The website used protocol (http, https)
              type: str
              default: http
              choices: ["http", "https"]
            require_server_name_indication:
              description:
                - To require Server Name Indication (SNI) for SSL certificates
                - Can be used only if protocol is https
                - When require_server_name_indication is true must specify C(hostname) value
              type: bool
              default: false
            use_centrelized_certificate_store:
              description:
                - To use IIS Centralized Certificate Store (CCS) for SSL certificates
                - Can be used only if protocol is https
                - If Central Certificate Store (CCS) is true C(certificate_hash) and C(certificate_store_name) shouldn't be used.
              type: bool
              default: false
            certificate_hash:
              description:
                - Certificate hash (thumbprint) for the SSL binding. The certificate hash is the unique identifier for the certificate.
                - You can only provide a certificate thumbprint when protocol is set to https
                - When using the Central Certificate Store feature, the certificate is automatically retrieved from the store rather than manually assigned to
                  the binding.
                - C(certificate_hash) and C(certificate_store_name) are required together
              type: str
            certificate_store_name:
              description:
                - Name of the certificate store where the certificate for the binding is located.
                - When using the Central Certificate Store feature, the certificate is automatically retrieved from the store rather than manually assigned to
                - C(certificate_hash) and C(certificate_store_name) are required together
              type: str
  notes:
    - This module must be run on a Windows target host with the C(IISAdministration) module installed.
  seealso:
    - module: microsoft.iis.website_info
    - module: microsoft.iis.web_app_pool
  author:
    - Shahar Golshani (@sgolshan)

EXAMPLES: |
  - name: Create a default website in 'Started' state
    microsoft.iis.website:
      name: WebSite
      physical_path: C:\inetpub\wwwroot
      state: started

  - name: Create a website with two bindings, set all values and starts it
    microsoft.iis.website:
      name: WebSite
      site_id: 2
      state: started
      physical_path: C:\wwwroot\websites\my-website
      application_pool: DefaultAppPool
      bindings:
        set:
          - ip: 127.0.0.1
            port: 8081
            hostname: my-website.com
          - ip: 127.0.0.2
            port: 8082
            hostname: my-website.net
            protocol: https
            require_server_name_indication: true
            use_centrelized_certificate_store: false
            certificate_hash: 5409124040FA1C8FA74939BDA2EF8FD5975BD25B
            certificate_store_name: MY

  - name: Stop a website
    microsoft.iis.website:
      name: WebSite
      state: stopped

  - name: Restart a website (non-idempotent)
    microsoft.iis.website:
      name: WebSite
      state: restarted

  - name: Change a website application pool
    microsoft.iis.website:
      name: WebSite
      application_pool: NewAppPool

  - name: Change a website physical path
    microsoft.iis.website:
      name: WebSite
      physical_path: C:\wwwroot\websites\my-website

RETURN: {}
