---
# Copyright: (c) 2025, Ansible Project
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

DOCUMENTATION:
  module: website
  short_description: Configures an IIS website
  description:
    - Creates, removes, and configures an IIS website.
  requirements:
    - C(IISAdministration) PowerShell module
  options:
    name:
      description:
        - The name of the website to manage.
      required: true
      type: str
    site_id:
      description:
        - Explicitly set the IIS website numeric ID.
        - Note that this value cannot be changed after the website has been created.
        - The site ID must be available and not used by any other website on the server.
      required: false
      type: str
    state:
      description:
        - State of the website
        - In order to start the website at least one binding should be configured
      type: str
      default: started
      choices: [absent, started, stopped, restarted]
    physical_path:
      description:
        - Specifies the physical folder path on the remote host to use for the website.
        - When create a new website physical_path is required.
        - The specified folder must already exist.
      type: str
    application_pool:
      description:
        - Specifies the application pool in which the website runs.
        - The application pool must already exist - otherwise the website will not start.
      type: str
    bindings:
      description:
        - Specifies the website bindings to add, remove or set.
        - The combination of C(ip:port:hostname) is the binding unique identifier
        - The binding C(ip:port) must be avialble and not used by any other website on the server.
        - To clear all website bindings, use I(set) with an empty list.
      type: dict
      default: {}
      suboptions:
        add:
          description:
            - Specifies a list of bindings to add to the website.
          type: list
          elements: dict
          suboptions:
            hostname:
              description: The website binding hostname (DNS)
              type: str
            ip:
              description: The website binding listen IP
              type: str
            port:
              description: The website binding listen port
              type: int
            protocol:
              description:
                - The website used protocol (http, https)
              type: str
              default: http
              choices: ["http", "https"]
            ssl_flags:
              description:
                - Indicates what type of certificate and certificate storage the website supports
                - Make sure C(ssl_flags) greater than zero (1,2,3) only specified with https protocol
                - C(ssl_flags) greater than one (2,3) indicates you wish to use the Central Certificate Store feature.
                - '0: Regular certificate in Windows certificate storage.'
                - '1: SNI certificate.'
                - '2: Central certificate store.'
                - '3: SNI certificate in central certificate store.'
              type: str
              default: "0"
              choices: ["0", "1", "2", "3"]
            certificate_hash:
              description:
                - Certificate hash (thumbprint) for the SSL binding. The certificate hash is the unique identifier for the certificate.
                - You can only provide a certificate thumbprint when protocol is set to https
                - This can be used only in combination with C(ssl_flags) 0 or 1.
                - When using the Central Certificate Store feature, the certificate is automatically retrieved from the store rather than manually assigned to
                  the binding.
              type: str
              default: ''
            certificate_store_name:
              description:
                - Name of the certificate store where the certificate for the binding is located.
                - This can be used only in combination with C(ssl_flags) 0 or 1
                - If not set store name 'my' will be used.
              type: str
              default: ''
        remove:
          description:
            - Specifies a list of bindings to remove from the website.
            - The combination of C(ip:port:hostname) is the binding unique identifier
          type: list
          elements: dict
          suboptions:
            hostname:
              description: The website binding hostname (DNS)
              type: str
            ip:
              description: The website binding listen IP
              type: str
            port:
              description: The website binding listen port
              type: int
        set:
          description:
            - Specifies a exact list of bindings to set to the website.
            - This will clear out any existing bindings if not in the specified
              list.
            - Set to an empty list to clear all the website bindings.
          type: list
          elements: dict
          suboptions:
            hostname:
              description: The website binding hostname (DNS)
              type: str
            ip:
              description: The website binding listen IP
              type: str
            port:
              description: The website binding listen port
              type: int
            protocol:
              description:
                - The website used protocol (http, https)
              type: str
              default: http
              choices: ["http", "https"]
            ssl_flags:
              description:
                - Indicates what type of certificate and certificate storage the website supports
                - Make sure C(ssl_flags) greater than zero (1,2,3) only specified with https protocol
                - C(ssl_flags) greater than one (2,3) indicates you wish to use the Central Certificate Store feature.
                - '0: Regular certificate in Windows certificate storage.'
                - '1: SNI certificate.'
                - '2: Central certificate store.'
                - '3: SNI certificate in central certificate store.'
              type: str
              default: "0"
              choices: ["0", "1", "2", "3"]
            certificate_hash:
              description:
                - Certificate hash (thumbprint) for the SSL binding. The certificate hash is the unique identifier for the certificate.
                - You can only provide a certificate thumbprint when protocol is set to https
                - This can be used only in combination with C(ssl_flags) 0 or 1.
                - When using the Central Certificate Store feature, the certificate is automatically retrieved from the store rather than manually assigned to
                  the binding.
              type: str
              default: ''
            certificate_store_name:
              description:
                - Name of the certificate store where the certificate for the binding is located.
                - This can be used only in combination with C(ssl_flags) 0 or 1
                - If not set store name 'my' will be used.
              type: str
              default: ''
    parameters:
      description:
        - Custom site Parameters from string where properties are separated by a pipe and property name/values by colon Ex. "foo:1|bar:2"
        - Some custom parameters that you can use are listed below, this isn't a definitive list but some common parameters.
        - C(logfile.directory) - Physical path to store Logs, e.g. C(D:\IIS-LOGs\).
        - C(logfile.period) - Log file rollover scheduled accepting these values, how frequently the log file should be rolled-over,
          e.g. C(Hourly, Daily, Weekly, Monthly).
        - C(logfile.LogFormat) - Log file format, by default IIS uses C(W3C).
        - C(logfile.truncateSize) - The size at which the log file contents will be trunsted, expressed in bytes.
      type: str
  notes:
    - This module consolidates M(community.windows.win_iis_website) and M(community.windows.win_iis_webbinding)
    - This module must be run on a Windows target host with the
      C(IISAdministration) module installed.
  seealso:
    - module: microsoft.iis.website_info
    - module: microsoft.iis.web_app_pool
  author:
    - Shahar Golshani (@sgolshan)

EXAMPLES: |
  - name: Create a new website in 'Started' state
    microsoft.iis.website:
      name: WebSite
      physical_path: C:\inetpub\wwwroot
      state: started

  - name: Stop a website
    microsoft.iis.website:
      name: WebSite
      state: stopped

  - name: Restart a website (non-idempotent)
    microsoft.iis.website:
      name: WebSite
      state: restarted

  - name: Change a website application pool
    microsoft.iis.website:
      name: WebSite
      application_pool: NewAppPool

  - name: Change a website physical path
    microsoft.iis.website:
      name: WebSite
      physical_path: C:\wwwroot\websites\my-website

  - name: Change the website parameters
    microsoft.iis.website:
      name: WebSite
      parameters: logfile.directory:"C:\IIS-LOGs"|logfile.period:Hourly|logFile.logFormat:W3C

  - name: Creates a website with two bindings, set all values and starts it
    microsoft.iis.website:
      name: WebSite
      site_id: 2
      state: started
      physical_path: C:\wwwroot\websites\my-website
      application_pool: DefaultAppPool
      bindings:
        set:
          - ip: 127.0.0.1
            port: 8081
            hostname: my-website.com
          - ip: 127.0.0.2
            port: 8082
            hostname: my-website.net
            protocol: https
            ssl_flags: 1
            certificate_hash: 5409124040FA1C8FA74939BDA2EF8FD5975BD25B
            certificate_store_name: my

RETURN: {}
